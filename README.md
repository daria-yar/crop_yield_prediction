**Система прогнозирования урожайности озимой пшеницы**

Микросервисная система для анализа и прогнозирования урожайности озимой пшеницы на основе спутниковых данных NDVI и метеорологических параметров.


Система предназначена для прогнозирования урожайности озимой пшеницы с использованием:

1. Вегетационного индекса NDVI (спутниковые данные MODIS)

2. Метеорологических параметров (температура, осадки, влажность, давление и др.)

3. Статистических данных об урожайности за предыдущие годы


**Сценарии использования**

Сценарий 1: отрисовка графика для выбранного параметра, года и района

В визуализации пользователь выбирает параметры: Область, Район, Год и метеопараметр.

Запрос из Web Master в Collector, Collector запрашивает необходимые данные из Storage, получаем нужный временной ряд (пройтись по scalar, найти номер нужной строки и обратиться по этому номеру в файл с временными рядами), из этой строки Collector вырезает значения нужного параметра и возращает его в Web Master.

Далее Web Master делает отрисовку графика, который отображается с помощью Visualizaton


Сценарий 2: построить корреляцию между максимумом NDVI и урожайностями прошлых лет для выбранного района

Пользователь выбрает Область -> район 

Collector делает запрос в Storage. Storage возвращает необходмые строки из файла с метеоданными и необходимые значение урожайности. Collector находит максимумы NDVI и передает соответсвующие пары значений в Web Master. 
Там реализуется отрисовка графика


Сценарий 3: сделать прогноз для выбранного района и выбранного года

Пользователь выбирает Область -> район и год

ML Service делает запрос в Collector за необходимыми данными. Collector создает запрос в Storage, он возращает 2 нужные строки из метеоданных + нужную строку из файла с метадаными

Collector склеивает данные и обрезает до нужного размера, совмещает с трендом и дисперсией из файла с метаданными присылает временной ряд размерностью (16, 245) (сентябрь - максимум NDVI). 

Web Master получает эти данные и делает запрос в ML Service.

ML Service делает прогноз и возвращет в Web Service полученное значение.


Сценарий 4: Линейная регрессия
Пользователь выбирает Область -> район и год

Web Master делает запрос в Collector, Collector делает запрос в Storage. 

Storage возвращет значения урожайностей за последние 5 лет и необходимые строки с метео за последние 6 лет (включая год предсказания). Collector находит максимумы NDVI и возвращает их парами с соответствующими урожайностями
    
Web Master делает запрос в ML Service. 

ML Service обучает линейную регрессию и прогнозирует урожайность для текущего года

ML Service возвращет в Web Master число


**Сервисы**

Storage:

    Содержимое:
        penza.csv            - временные ряды с NDVI и метеорологическими данными для районов Пензенской области
        penza_scalar.csv     - метаданные для соответствующих строк из файла с временными рядами
        tula.csv             - временные ряды с NDVI и метеорологическими данными для районов Тульской области
        tula_scalar.csv      - метаданные для соответствующих строк из файла с временными рядами
        tambov.csv           - временные ряды с NDVI и метеорологическими данными для районов Тамбовской области
        tambov_scalar.csv    - метаданные для соответствующих строк из файла с временными рядами
        config.json          - информация для сопоставления названий районов и их id


    Что умеет:
        Считывать файл по переданным данным о параметрах и возвращать содержимое файлов
        Сопоставляет метаинформацию с временными рядами для возвращения требуемых строк данных
        Возвращать необходимую урожайность



Collector:

    Что умеет:
        Выделять нужный рад с выбранным параметром из строки
        Находить максимум NDVI
        Склеивать данные за 2 года
        Обрезать временной ряд до нужной длины



ML Service:

    Содержимое:
        Winter_Wheat.pt - файл с весами модели


    Что умеет:
        Загрузить модель в память
        Сделать предсказание с помощью модели
        Обучение линейной регрессии 
        Предсказание урожайности с помощью линейной регрессии


Web Service:

    Что умеет:

        Реализовывает 4 сценария и отдает данные для визуализвации



**Запуск и управление:**
```bash
# Запуск всех сервисов
make start

# Перезапуск всех сервисов
make restart

# Остановка всех сервисов
make stop
```

Доступ к интерфейсу при запуске:

http://172.18.0.6:8050/